## 进程调度

上下文切换

- 切换CPU的当前任务，从一个线程、进程到另外一个
- 保存当前进程、线程在PCB/TCP中的执行上下文
- 读取下一个进程/线程的上下文

CPU调度

- 从就绪队列中挑选一个进程或线程作为CPU作为一个进程或线程
- 调度程序：挑选进程、线程的内核函数



内核运行调度的条件

- 一个进程从运行状态切换到等待状态
- 一个进程被终结了

不可抢占

- 调度程序必须等待事件结束

可抢占

- 调度程序可中断
- 当前的进程从运行切换到就绪，
- 当前运行的进程可被换出。

### 调度原则

**CPU使用率**

 	cpu处于状态所占时间的百分比

**吞吐量**

​	在单位时间内完成的进程的数量

**周转时间**

​	一个从初始化到结束，包括所有等待时间所花费的时间

**等待时间**

​	进程在就绪队列中的总时间

**响应时间**

​	从一个请求到到第一次请求所花费的时间



更快的处理

- 传输文件的高宽带
- 玩游戏的低延迟

和水管的类比

- 低延迟 
- 高带宽 给游泳池充水，需要大量的水

减少响应、增加吞吐量、减少等待时间。



### 调度算法

- FCFS 先来先服务 使用FIFO队列

  缺点：平均等待时间波动大，花费时间少的任务可能排在花费时间长的任务后面

  可能导致io、cpu重叠

- SPN 短作业优先

  按照预测完成的时间来将队列入队列。

  缺点：会使长任务饥饿，增加长任务的等待时间

- HRRN 最高响应比优先

  在spn的基础上改进，关注进程等待时间

  r= (w+s)/s  w = waiting time   s= service time

- Round  轮询

  分配一定的时间片，然后每个时间片用完。就执行下一个。每个进程都有机会 执行。

  时间量子太大 等待时间过长， 时间量子太小，反应快，上下文切换频繁

- MFQ 多级反馈队列

  就绪队列分成不同的队列，每个队列分配自己的调度策略。

- FSS 公平共享调度

  控制用户对系统资源的访问

  保证不重要的组无法垄断资源。

### 实时调度

强实时系统

需要在保证的时间内完成重要的任务，必须完成

弱实时系统

要求重要的进程的优先级更高，尽量完成。

RM(Rate monotonice) 速率单调调度

### 多处理器调度

- 多个相同的单处理器组成一个多处理器
- 负载共享

对称多处理器

- 对每个处理器运行自己的调度程序
- 需要在调度程序中同步

低优先级任务继承高优先级的任务的优先级